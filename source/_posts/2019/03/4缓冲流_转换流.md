---
title:缓冲流_转换流
date: 2019-03-13 09:23:13
categories: Java
---
# 第一章 缓冲流

## 1.1 概述

缓冲流,也叫高效流，是对4个基本的`FileXxx` 流的增强，所以也是4个流，按照数据类型分类：

- **字节缓冲流**：`BufferedInputStream`，`BufferedOutputStream` 
- **字符缓冲流**：`BufferedReader`，`BufferedWriter`

缓冲流的基本原理，是在创建流对象时，会创建一个内置的默认大小的缓冲区数组，通过缓冲区读写，减少系统IO次数，从而提高读写的效率。

## 1.2 字节缓冲输出流

- `java.io.BufferedOutputStream extends OutputStream`

- `BufferedOutputStream`：字符缓冲输出流

继承自父类的共性成员方法：

 - `public void close() `：关闭此输出流并释放与此流相关联的任何系统资源。
 - `public void flush()` ：刷新此输出流并强制任何缓冲的输出字节被写出。
 - `public void write(byte[] b)`：将 b.length字节从指定的字节数组写入此输出流。
 - `public void write(byte[] b, int off, int len)` ：从指定的字节数组写入 len字节，从偏移量 off开始输出到此输出流。
 - `public abstract void write(int b) `：将指定的字节输出流。

### 构造方法

- `BufferedOutputStream(OutputStream out)`  创建一个新的缓冲输出流，以将数据写入指定的底层输出流。

- `BufferedOutputStream(OutputStream out, int size)`  创建一个新的缓冲输出流，以将具有指定缓冲区大小的数据写入指定的底层输出流。

  参数：

  `OutputStream out`：字节输出流，我们可以传递FileOutputStream，缓冲流会给FileOutputStream增加一个缓冲区，提高FileOutputStream的写入效率

  `int size`：指定缓冲流内部缓冲区的大小，不指定为默认大小

### 使用步骤（重）

1. 创建FileOutputStream对象，构造方法中绑定要输出的目的地
2. 创建BufferedOutputStream对象，构造方法中传递FileOutputStream对象，提高FileOutputStream对象效率
3. 使用BufferedOutputStream对象中的方法write()，把数据写入到内部缓冲区
4. 使用BufferedOutputStream对象中的方法flush()，把内部缓冲区中的数据，刷新到文件
5. 释放资源（会先调用flush方法刷新数据，第四步可以省略）

```java
import java.io.BufferedOutputStream;
import java.io.FileOutputStream;
import java.io.IOException;

public class Demo01BufferedOutputStream {
    public static void main(String[] args) throws IOException {
        FileOutputStream fos = new FileOutputStream("E:\\a.txt");
        BufferedOutputStream bos = new BufferedOutputStream(fos);
        bos.write("我把数据写入到内部缓冲区中".getBytes());
        //bos.flush();
        bos.close();
    }
}
```

## 1.3 字节缓冲输入流

- `java.io.BufferedInputStream extends InputStream`
- `BufferedInputStream:字节缓冲输入流`

继承自父类的共性成员方法：

- `int read()`从输入流中读取数据的下一个字节。
- `int read(byte[] b)` 从输入流中读取一定数量的字节，并将其存储在缓冲区数组 b 中。
- `void close()` 关闭此输入流并释放与该流关联的所有系统资源。

### 构造方法

- `BufferedInputStream(InputStream in)` 创建一个 BufferedInputStream 并保存其参数，即输入流 in，以便将来使用。

- `BufferedInputStream(InputStream in, int size)` 创建具有指定缓冲区大小的 BufferedInputStream 并保存其参数，即输入流 in，以便将来使用。

  参数：

  `InputStream in `：字节输入流，我们可以传递FileInputStream，缓冲流会给FileInputStream增加一个缓冲区，提高FileInputStream的读取效率

  `int size`：指定缓冲流内部缓冲区的大小，不指定为默认大小

### 使用步骤（重）

1. 创建FileInputStream对象，构造方法中绑定要读取的数据源
2. 创建BufferedFileInputStream对象，构造方法中传递FileInputStream对象，提高FileInputStream对象的读取效率
3. 使用BufferedFileInputStream对象中的方法read()读取文件
4. 释放资源

```java
import java.io.BufferedInputStream;
import java.io.FileInputStream;
import java.io.IOException;

public class Demo02BufferedInputStream {
    public static void main(String[] args) throws IOException {
        FileInputStream fis = new FileInputStream("E:\\a.txt");
        BufferedInputStream bis = new BufferedInputStream(fis);
        int len = 0;//记录每次读取到的字节
        while ((len = bis.read())!= -1){
            System.out.println(len);
        }
        bis.close();
    }
}
```

## 1.4 文件复制

步骤：

1. 创建字节缓冲输入流对象，构造方法中传递字节输入流
2. 创建字节缓冲输出流对象，构造方法中传递字节输出流
3. 使用字节缓冲输入流对象中的方法read，读取文件
4. 使用字节缓冲输出流对象中的方法write，把读取的数据写入内部缓冲区中
5. 释放资源（会先把缓冲区中的数据，刷新到文件中）

## 1.5 字符缓冲输出流

- java.io.BufferedWriter extends Writer
- BufferedWriter：字符缓冲输出流

继承自父类的共性成员方法:
   - void write(int c) 写入单个字符。
   - void write(char[] cbuf)写入字符数组。
   - abstract  void write(char[] cbuf, int off, int len)写入字符数组的某一部分,off数组的开始索引,len写的字符个数。
   - void write(String str)写入字符串。
   - void write(String str, int off, int len) 写入字符串的某一部分,off字符串的开始索引,len写的字符个数。
   - void flush()刷新该流的缓冲。
   - void close() 关闭此流，但要先刷新它。

### 构造方法

- BufferedWriter(Writer out) 创建一个使用默认大小输出缓冲区的缓冲字符输出流。          

- BufferedWriter(Writer out, int sz) 创建一个使用给定大小输出缓冲区的新缓冲字符输出流。

  参数：

  Writer out：字符输出流，我们可以传递FileWriter，缓冲流会给FileWriter增加一个缓冲区，提高FileWriter的写入效率

  int sz：指定缓冲区的大小，不写默认大小

### 特有成员方法

void newLine() 写入一个行分隔符。会根据不同的操作系统,获取不同的行分隔符
换行:换行符号
        windows:\r\n
        linux:/n
        mac:/r

### 使用步骤（重）

1. 创建字符缓冲输出流对象，构造方法中传递字符输出流
2. 调用字符缓冲输出流对象中的方法write，把数据写入到内存缓冲区中
3. 调用字符缓冲输出流对象中的方法flush，把内存缓冲区中的数据刷新搭配文件中
4. 释放资源

```java
import java.io.BufferedWriter;
import java.io.FileWriter;
import java.io.IOException;

public class Demo01BufferedWriter {
    public static void main(String[] args) throws IOException {
        BufferedWriter bw = new BufferedWriter(new FileWriter("E:\\a.txt"));
        for (int i = 0; i < 10; i++) {
            bw.write("西安交通大学城市学院");
            //bw.write("\r\n");
            bw.newLine();//换行
        }
        bw.flush();
        bw.close();
    }
}
```

## 1.6 字符缓冲输入流

- java.io.BufferedReader extends Reader
- BufferedReader：字符缓冲输入流

继承自父类的共性成员方法:

- int read() 读取单个字符并返回。
- int read(char[] cbuf)一次读取多个字符,将字符读入数组。
- void close() 关闭该流并释放与之关联的所有资源。

### 构造方法

- BufferedReader(Reader in)  创建一个使用默认大小输入缓冲区的缓冲字符输入流。

- BufferedReader(Reader in, int sz)     创建一个使用指定大小输入缓冲区的缓冲字符输入流。

  参数:
  Reader in:字符输入流，我们可以传递FileReader,缓冲流会给FileReader增加一个缓冲区,提高FileReader的读取效率

### 特有成员方法

String readLine() 读取一个文本行。读取一行数据。行的终止符号:通过下列字符之一即可认为某行已终止：换行 ('\n')、回车 ('\r') 或回车后直接跟着换行(\r\n)。

返回值:包含该行内容的字符串，不包含任何行终止符，如果已到达流末尾，则返回 null

### 使用步骤（重）

1. 创建字符缓冲输入流对象,构造方法中传递字符输入流
2. 使用字符缓冲输入流对象中的方法read/readLine读取文本
3. 释放资源

```java
import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;

public class Demo01BufferedReader {
    public static void main(String[] args) throws IOException {
        BufferedReader br = new BufferedReader(new FileReader("E:\\a.txt"));
//        String line = br.readLine();
//        System.out.println(line);
//
//        line = br.readLine();
//        System.out.println(line);
//
//        line = br.readLine();
//        System.out.println(line);

        String line;
        while ((line = br.readLine()) != null){
            System.out.println(line);
        }

        br.close();
    }
}
```

# 第二章 转换流

## 2.1 字符编码和字符集

### 字符编码

> 一套自然语言的字符（生活中的文字）与二进制数之间的对应规则

编码：字符（能看懂的）--->字节（看不懂）

解码：字节（看不懂）--->字符（能看懂的）

**注：按照A规则存储，同样按照A规则解析，能正常显示正确的文本；反之，按照A规则存储，再按B规则解析，就会导致乱码现象。**

### 字符集

> 常见字符集有ASCII字符集、GBK字符集、Unicode字符集等

- ASCII字符集：使用7位（bits）表示一个字符，共128字符；扩展字符集使用8位（bits）表示一个字符，共256字符。
- ISO-8895-1：拉丁码表，使用单字节编码，兼容ASCII编码
- GBXXX字符集：为了显示中文而设计的一套字符集
  - GB2312：简体中文码表
  - GBK：最常用的中文码表
  - GB18030：最新的中文码表
- Unicode字符集：统一码、万国码；编码方案：UTF-8、UTF-16、UTF-32，最常用UTF-8编码

### 编码出现问题

在IDEA中，使用`FileReader` 读取项目中的文本文件。由于IDEA的设置，都是默认的`UTF-8`编码，所以没有任何问题。但是，当读取Windows系统中创建的文本文件时，由于Windows系统的默认是GBK编码，就会出现乱码。

## 2.2 OutputStreamWriter

- **java.io.OutputStreamWriter extends Writer**
- OutputStreamWriter: 是字符流通向字节流的桥梁：可使用指定的 charset 将要写入流中的字符编码成字节。(编码:把能看懂的变成看不懂)

继承自父类的共性成员方法:

- void write(int c) 写入单个字符。  
- void write(char[] cbuf)写入字符数组。
- abstract  void write(char[] cbuf, int off, int len)写入字符数组的某一部分,off数组的开始索引,len写的字符个数。
- void write(String str)写入字符串。
- void write(String str, int off, int len) 写入字符串的某一部分,off字符串的开始索引,len写的字符个数。
- void flush()刷新该流的缓冲。
- void close() 关闭此流，但要先刷新它。

### 构造方法

- OutputStreamWriter(OutputStream out) 创建使用默认字符编码的 OutputStreamWriter。

- OutputStreamWriter(OutputStream out, String charsetName) 创建使用指定字符集的 OutputStreamWriter。

- 参数：

  OutputStream out：字节输出流，可以用来写转换之后的字节到文件中

  String charsetName：指定的编码表名称，utf-8/Utf-8，不区分大小写

### 使用步骤（重）

1. 创建OutputStreamWriter对象，构造方法中传递字节输出流和指定的编码表名称
2. 使用OutputStreamWriter对象中的方法write，把字符转化为字节存储到缓冲区中
3. 使用OutputStreamWriter对象中的方法flush，把内存缓冲区中的字节刷新到文件中（使用字节流写字节的过程）
4. 释放资源

```java
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.OutputStreamWriter;

public class Demo02OutputStreamWriter {
    public static void main(String[] args) throws IOException {
        //write_utf_8();
        write_gbk();
    }


    private static void write_gbk() throws IOException{

        OutputStreamWriter osw = new OutputStreamWriter(new FileOutputStream("E:\\gbk.txt"),"GBK");
        osw.write("你好");
        osw.flush();
        osw.close();
    }

    private static void write_utf_8() throws IOException{
        OutputStreamWriter osw = new OutputStreamWriter(new FileOutputStream("E:\\utf_8.txt"),"utf-8");
        osw.write("你好");
        osw.flush();
        osw.close();
    }
}

```

## 2.3 InputStreamReader

- java.io.InputStreamReader extends Reader
- InputStreamReader:是字节流通向字符流的桥梁：它使用指定的 charset 读取字节并将其解码为字符。(解码:把看不懂的变成能看懂的)

继承自父类的共性成员方法:

- int read() 读取单个字符并返回。
- int read(char[] cbuf)一次读取多个字符,将字符读入数组。
- void close() 关闭该流并释放与之关联的所有资源。

### 构造方法

- InputStreamReader(InputStream in) 创建一个使用默认字符集的 InputStreamReader。

- InputStreamReader(InputStream in, String charsetName) 创建使用指定字符集的 InputStreamReader。

- 参数：

  InputStream  in：字节是输入流，有读取文件中保存的字节

  String charsetName：指定的编码表名称，utf-8/Utf-8，不区分大小写

### 使用步骤（重）

1. 创建InputStreamReader对象，构造方法中传入字节输入流和指定编码表名称
2. 使用InputStreamReader对象中的方法read读取文件
3. 释放资源

注意事项：

​	构造方法中指定的编码表名称要和文件的编码相同，否则会发生乱码

```java
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStreamReader;

public class Demo03InputStreamReader {
    public static void main(String[] args) throws IOException {
        //read_utf_8();
        read_gbk();
    }

    private static void read_gbk() throws IOException {
        InputStreamReader isr = new InputStreamReader(new FileInputStream("E:\\gbk.txt"),"GBK");
        int len = 0;
        while ((len = isr.read()) != -1){
            System.out.println((char) len);
        }
        isr.close();
    }

    private static void read_utf_8() throws IOException {
        //InputStreamReader isr = new InputStreamReader(new FileInputStream("E:\\utf_8.txt"),"utf-8");
        InputStreamReader isr = new InputStreamReader(new FileInputStream("E:\\utf_8.txt"));
        int len = 0;
        while ((len = isr.read()) != -1){
            System.out.println((char) len);
        }
        isr.close();
    }
}
```

## 练习

```java
import java.io.*;

/*
    练习：转换文件编码
        将GBK编码的文件，转化为UTF-8编码的文件
    分析：
        1.创建InputStreamReader对象，构造方法中传递字节输入流和指定的编码表名称GBK
        2.创建OutputStreamWriter对象，构造方法中传入字节输出流和指定的编码格式UTF-8
        3.使用InputStreamReader对象中的方法read读取文件
        4.使用OutputStreamWriter对象中的方法write，把读取的数据写入到文件中
        5.释放资源
 */
public class TransDemo {
    public static void main(String[] args) throws IOException {
        InputStreamReader isr = new InputStreamReader(new FileInputStream("E:\\gbk.txt"),"GBK");
        OutputStreamWriter osw = new OutputStreamWriter(new FileOutputStream("E:\\我是Utf-8.txt"),"UTF-8");

        int len = 0;
        while ((len = isr.read()) != -1){
            osw.write(len);
        }

        osw.close();
        isr.close();
    }
}
```




