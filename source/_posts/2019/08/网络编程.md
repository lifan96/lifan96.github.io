---
title: 网络编程
date: 2019-08-02 18:23:13
categories: Java
---

# 第一章 网络编程入门

## 1.1 软件结构

- **C/S结构** ：全称为Client/Server结构，是指客户端和服务器结构。常见程序有ＱＱ、迅雷等软件。
- **B/S结构** ：全称为Browser/Server结构，是指浏览器和服务器结构。常见浏览器有谷歌、火狐等。

## 1.2 网络通信协议

- **网络通信协议：**通过计算机网络可以使多台计算机实现连接，位于同一个网络中的计算机在进行连接和通信时需要遵守一定的规则，这就好比在道路中行驶的汽车一定要遵守交通规则一样。在计算机网络中，这些连接和通信的规则被称为网络通信协议，它对数据的传输格式、传输速率、传输步骤等做了统一规定，通信双方必须同时遵守才能完成数据交换。

- **TCP/IP协议：** 传输控制协议/因特网互联协议( Transmission Control Protocol/Internet Protocol)，是Internet最基本、最广泛的协议。它定义了计算机如何连入因特网，以及数据如何在它们之间传输的标准。它的内部包含一系列的用于处理数据通信的协议，并采用了4层的分层模型，每一层都呼叫它的下一层所提供的协议来完成自己的需求。

  ![image](https://ws1.sinaimg.cn/large/80ceacb8gy1g17393zyfmj20dm08qjux.jpg)

上图中，TCP/IP协议中的四层分别是应用层、传输层、网络层和链路层，每层分别负责不同的通信功能。
链路层：链路层是用于定义物理传输通道，通常是对某些网络连接设备的驱动协议，例如针对光纤、网线提供的驱动。
网络层：网络层是整个TCP/IP协议的核心，它主要用于将传输的数据进行分组，将分组数据发送到目标计算机或者网络。
运输层：主要使网络程序进行通信，在进行网络通信时，可以采用TCP协议，也可以采用UDP协议。
应用层：主要负责应用程序的协议，例如HTTP协议、FTP协议等。

## 1.3 协议分类

- **UDP**：*面向无连接通信协议*--->即在数据传输时，数据的发送端和接收端不建立逻辑连接。

  数据报：网络传输的基本单位

  特点：消耗资源小，通信效率高；数据被限制在64kb以内

  应用于：音频、视频和普通数据传输

- **TCP**：传输控制协议；面向连接的通信协议--->即传输数据之前，在发送端和接收端建立逻辑连接，然后再传输数据，它提供了两台计算机之间可靠无差错的数据传输。

  在TCP连接中**必须要明确客户端与服务器端**，由客户端向服务端发出连接请求，每次连接的创建都需要经过“**三次握手**”。

  - 第一次握手：客户端向服务器发出连接请求，等待服务器确认
  - 第二次握手：服务器向客户端返回一个响应，通知客户端收到了连接请求
  - 第三次握手：客户端再次向服务器端发送确认信息，确认连接

  应用于：下载文件、浏览网页等

## 1.4 网络编程的三要素

- **协议**

- **IP地址**

  **IP地址：指互联网协议地址（Internet Protocol Address）**，俗称IP。IP地址用来给一个网络中的计算机设备做唯一的编号。假如我们把“个人电脑”比作“一台电话”的话，那么“IP地址”就相当于“电话号码”。

- IP地址分类

  - IPv4：**是一个32位的二进制数，通常被分为4个字节，表示成`a.b.c.d` 的形式***，例如`192.168.65.100` 。其中a、b、c、d都是0~255之间的十进制整数，那么最多可以表示42亿个。

  - IPv6：由于互联网的蓬勃发展，IP地址的需求量愈来愈大，但是网络地址资源有限，使得IP的分配越发紧张。

    为了扩大地址空间，拟通过IPv6重新定义地址空间，**采用128位地址长度，每16个字节一组，分成8组十六进制数，表示成`ABCD:EF01:2345:6789:ABCD:EF01:2345:6789`**，号称可以为全世界的每一粒沙子编上一个网址，这样就解决了网络地址资源数量不够的问题。

- **端口号**

  端口号是一个逻辑端口；当我们使用网络软件时，操作系统就会为网络软件分配一个随机的端口号或者网络软件打开的时候系统会指定一个端口号

  组成：有两个字节组成，取值范围在0~65535之间

  注意：1024之前的端口号不能使用，已经被系统分配给已知的网络软件

  ​           网络软件的端口号不能重复

  常用端口号：80：网络端口；3306：MySQL；1521：Oracle；8080：Tomcat服务器

# 第二章 TCP通信程序

## 2.1 概述

### 两端通信时步骤

1. 服务器端程序，需要事先启动，等待客户端的连接。
2. 客户端主动连接服务器端，连接成功后才能通信。服务器端不可以主动连接客户端。

### Java实现TCP通信的两个类

1. 客户端：`java.net.Socket` 类表示。创建`Socket`对象，向服务端发出连接请求，服务端响应请求，两者建立连接开始通信。
2. 服务端：`java.net.ServerSocket` 类表示。创建`ServerSocket`对象，相当于开启一个服务，并等待客户端的连接。
3. 简单记：服务器使用客户端的流和客户端交互

## 2.2 Socket类

`Socket` 类：该类实现客户端套接字，套接字指的是包含了IP地址和端口号的网络单位。

### 构造方法

- Socket(String host,int port)：创建一个流套接字并将其连接到指定主机上的指定端口号

- 参数：

  String host：服务器的名称、服务器的IP地址

  int port：服务器的端口号

- 成员方法：

  OutputStream getOutputStream()：返回此套接字的输出流

  InputStream getInputStream()：返回此套接字的输入流

  void close()：关闭此套接字

### 创建步骤

1. 创建一个客户端对象Socket，构造方法绑定服务器的IP地址和端口号
2. 使用Socket对象中的方法getOutputStream()获取网络字节输出流对象
3. 使用网络字节输出流OutputStream 对象中的方法write，给服务器发送数据
4. 使用Socket对象中的方法getInputStream()获取网络字节输入流对象InputStream对象
5. 使用网络字节输入流InputStream对象中的方法read，读取服务器回写的数据
6. 释放资源（Socket）

### 注意

1. 客户端和服务器端进行交互，必须使用Socket中提供的网络流，不能使用自己创建的流对象

2. 当我们创建客户端对象Socket的时候，就会去请求服务器和服务器经过三次握手建立连接

   这时如果服务器没有启动，那么就会抛出异常

```java

import java.io.IOException;
import java.io.OutputStream;
import java.net.Socket;

public class TCPClient {
    public static void main(String[] args) throws IOException {
        Socket socket = new Socket("127.0.0.1",8888);

        OutputStream os = socket.getOutputStream();
        os.write("你好服务器".getBytes());

       //4. 使用Socket对象中的方法getInputStream()获取网络字节输入流对象InputStream对象
       //5. 使用网络字节输入流InputStream对象中的方法read，读取服务器回写的数据
        InputStream is = socket.getInputStream();
        byte[] bytes = new byte[1024];
        int len = is.read(bytes);
        String msg = new String(bytes, 0, len);
        System.out.println(msg);

        socket.close();
    }
}
```

## 2.3 ServerSocket类

`ServerSocket`类：这个类实现了服务器套接字，该对象等待通过网络的请求。

### 构造方法

- ServerSocket(int port)：创建绑定到特定端口的服务器套接字

### 成员方法

- Socket accept()：侦听并接受到此套接字的连接
- 服务器必须明确--->必须知道是哪个客户端请求的服务器，所以可以使用accept方法获取到请求的客户端对象Socket

### 服务器端实现步骤

1. 创建ServerSocket对象和系统要指定的端口号
2. 使用ServerSocket对象中的方法accept方法，获取到请求的客户端对象Socket
3. 使用Socket对象中的方法getInputStream()获取网络字节输入流对象InputStream对象
4. 使用网络字节输入流InputStream对象中的方法read，读取客户端发送的数据
5. 使用Socket对象中的方法getOutputStream()获取网络字节输出流对象
6. 使用网络字节输出流OutputStream 对象中的方法write，给客户端回写数据
7. 释放资源（Socket，ServerSocket）

```java
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.ServerSocket;
import java.net.Socket;

public class TCPServer {
    public static void main(String[] args) throws IOException {
        ServerSocket serverSocket = new ServerSocket(8888);
        Socket socket = serverSocket.accept();

        InputStream is = socket.getInputStream();
        byte[] bytes = new byte[1024];
        int len = is.read(bytes);
        String msg = new String(bytes, 0, len);
        System.out.println(msg);

        OutputStream os = socket.getOutputStream();
        os.write("收到谢谢".getBytes());

        socket.close();
        serverSocket.close();

    }
}
```

